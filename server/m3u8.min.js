var M3u8 = function (t) { "use strict"; var e, u = (function (e) { function n(t) { return (n = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (t) { return typeof t } : function (t) { return t && "function" == typeof Symbol && t.constructor === Symbol && t !== Symbol.prototype ? "symbol" : typeof t })(t) } function r(t) { return "function" == typeof Symbol && "symbol" === n(Symbol.iterator) ? e.exports = r = function (t) { return n(t) } : e.exports = r = function (t) { return t && "function" == typeof Symbol && t.constructor === Symbol && t !== Symbol.prototype ? "symbol" : n(t) }, r(t) } e.exports = r }(e = { exports: {} }, e.exports), e.exports); var n = function (t) { if (Array.isArray(t)) return t }; var r = function (t, e) { if (Symbol.iterator in Object(t) || "[object Arguments]" === Object.prototype.toString.call(t)) { var n = [], r = !0, o = !1, i = void 0; try { for (var c, a = t[Symbol.iterator](); !(r = (c = a.next()).done) && (n.push(c.value), !e || n.length !== e); r = !0); } catch (t) { o = !0, i = t } finally { try { r || null == a.return || a.return() } finally { if (o) throw i } } return n } }; var o = function () { throw new TypeError("Invalid attempt to destructure non-iterable instance") }; var l = function (t, e) { return n(t) || r(t, e) || o() }, i = { audio: { a3ds: !0, "ac-3": !0, "ac-4": !0, alac: !0, alaw: !0, dra1: !0, "dts+": !0, "dts-": !0, dtsc: !0, dtse: !0, dtsh: !0, "ec-3": !0, enca: !0, g719: !0, g726: !0, m4ae: !0, mha1: !0, mha2: !0, mhm1: !0, mhm2: !0, mlpa: !0, mp4a: !0, "raw ": !0, Opus: !0, samr: !0, sawb: !0, sawp: !0, sevc: !0, sqcp: !0, ssmv: !0, twos: !0, ulaw: !0 }, video: { avc1: !0, avc2: !0, avc3: !0, avc4: !0, avcp: !0, drac: !0, dvav: !0, dvhe: !0, encv: !0, hev1: !0, hvc1: !0, mjp2: !0, mp4v: !0, mvc1: !0, mvc2: !0, mvc3: !0, mvc4: !0, resv: !0, rv60: !0, s263: !0, svc1: !0, svc2: !0, "vc-1": !0, vp08: !0, vp09: !0 } }; var s = "NONE", c = "AES-128", a = /ats_(\d+)_dts(\d+)\.ts/, f = { cc: 0, offset: 0, keyMethod: "", resetKeyMethod: function () { f.keyMethod = "" }, setKeyMethod: function (t) { if (t && t === c) return f.cc += 1, void f.resetKeyMethod(); f.keyMethod = t }, dispatch: function (t, e, n, r) { var o = t.toUpperCase(); return !!this[o] && (this[o](t, e, n, r), !0) }, on: function (t, e) { var n = t.toUpperCase(); f[n] = e }, reset: function () { f.cc = 0, f.offset = 0, f.resetKeyMethod() } }; function v(t) { var e = a.exec(t); if (e) { var n = l(e, 3), r = (n[0], n[1]), o = n[2]; if (r && o) return { seqNo: +r, absDts: +o } } } f.on("INF", function (t, e, n) { var r = l(e, 2), o = r[0], i = r[1]; if (!(o < .1)) { var c = n.segments[n.segments.length - 1], a = c ? c.end : 0, u = n.segments.length, s = { duration: parseFloat(o), id: n.startSN + u, start: a, end: a + parseFloat(o), cc: f.cc, offset: f.offset || 0 }; i && (s.title = i), n.segments.push(s) } }), f.on("XPRIVINF", function (t, e, n, r) { Array.isArray(e) && (e = e.reduce(function (t, e) { return t[e] = 0, t }, {})); var o = "MASTER" === r ? n.levels : n.segments; Object.assign(o[o.length - 1], e) }), f.on("XKEY", function (t, e, n) { f.setKeyMethod(e.method) }), f.on("XSTREAMINF", function (t, e, n) { e.codecs && function (r, o) { ["video", "audio"].forEach(function (e) { var n = r.filter(function (t) { return "mp4a" !== t && "avc1" !== t && function (t, e) { var n = i[e]; return t && !!n && !0 === n[t.slice(0, 4)] }(t, e) }); if (n.length) { var t = n.filter(function (t) { return 0 === t.lastIndexOf("avc1", 0) || 0 === t.lastIndexOf("mp4a", 0) }); o["".concat(e, "Codec")] = 0 < t.length ? t[0] : n[0], r = r.filter(function (t) { return -1 === n.indexOf(t) }) } }), o.unknownCodecs = r }([].concat((e.codecs || "").split(/[ ,]+/)), e), n.levels.push(e), n.levels = n.levels.sort(function (t, e) { return t.bandwidth > e.bandwidth ? -1 : 1 }); var r = n.levels.length; n.levels.forEach(function (t, e) { t.levelId = r - e }) }), f.on("XMEDIASEQUENCE", function (t, e, n) { n.startSN = e[0] }), f.on("XDISCONTINUITY", function (t, e, n) { f.cc += 1 }), f.on("URL", function (t, e, n, r) { for (var o = e.url || e, i = "MASTER" === r ? n.levels : n.segments, c = 0; c < i.length; c++)if (!i[c].url) { var a = v(o); return a && (i[c].absoluteDts = a.absDts), i[c].url = o, void (f.keyMethod && f.keyMethod === s && (i[c].drm_notencrypt = 0)) } }), f.on("XENDLIST", function (t, e, n) { n.live = !1 }), f.on("EXTRAPROPS", function (t, e, n, r) { if ("LEVEL" === r) { var o = n.segments; n.totalDuration = o.map(function (t) { return t.duration }).reduce(function (t, e) { return t += e }, 0), n.totalDuration = +n.totalDuration.toFixed(3), n.endSN = o[o.length - 1].id } }); var d = /^#EXTM3U/, p = /^#EXT(?:-?)([^:]*):?(.*)$/, h = /^#EXT-(X-DISCONTINUITY)$/, m = /([^=]+)((="[^"]+)|(=?[^,]+))/g, y = /^([^=]+)=?(.*)$/, g = 2; function b(t) { return -1 === t.indexOf("-") ? t.toLowerCase() : t.split("-").map(function (t, e) { return 0 === e ? t.toLowerCase() : t[0] + t.slice(1).toLowerCase() }).join("") } function S(t, c) { return -1 === t.indexOf("=") ? t.split(",").filter(Boolean).map(function (t) { return isNaN(Number(t)) ? b(t) : Number(t) }) : t.trim().match(m).map(function (t) { return "," === t.charAt(0) && (t = t.slice(1)), '"' === t.charAt(0) && "," === t.charAt(1) && (t = t.slice(2)), t.replace(/"/, "") }).reduce(function (t, e) { var n = y.exec(e); if (n && n.length) { var r = l(n, 3), o = r[1], i = r[2]; "URI" === o && (o = "URL"), t[b(o)] = isNaN(Number(i)) ? function (t, e, n) { return "URL" !== t ? e : x(e, n) }(o, i.replace(/"/g, ""), c) : Number(i) } return t }, {}) } function x(t, e) { var n; n = !1 === /^(http|https|\/\/)/.test(t) ? Array.from(new Set(e.split("/").concat(t.split("/")))).join("/") : t, n = "https:" === location.protocol ? n.replace(/^(https|http)/, "https") : n; var r = /m3u8host=([^&$]+)/.exec(location.search); return r && r.length && (n = n.replace("pl-ali.youku.com", r[1])), n } function E(t, e) { var n = t.map(function (t) { return !!t.audio && { id: t.audio, codec: t.audioCodec } }).filter(Boolean); n.length && (Array.isArray(e.xMedia) || (e.xMedia = [e.xMedia]), e.xMedia.forEach(function (t) { if ("AUDIO" === t.type) { var e = function (t, e) { if (!t) return null; for (var n = null, r = 0; r < t.length; r++) { var o = t[r]; o.id === e && (n = o) } return n }(n, t.groupId); t.audioCodec = e ? e.codec : n[0].codec } })) } return t.probe = function (t) { return d.test(t.trim()) }, t.parse = function (t, i, e) { var n = 3 < arguments.length && void 0 !== arguments[3] ? arguments[3] : [], c = { error: 0, startSN: 0, segments: [], levels: [], xMedia: [] }; try { f.reset(); var a = function (t) { if (!t) return ""; /^\/\//.test(t) && (t = location.protocol + t); var e = t.split("/"); return e.slice(0, e.length - 1).join("/") }(e); return t.split("\n").filter(Boolean).map(function (t) { return t.trim() }).forEach(function (t) { var e, n; if ("#" !== t.charAt(0)) e = "url", n = x(t, a); else { var r = function (t) { if (h.test(t)) return ["", "xDiscontinuity", ""]; var e = p.exec(t); return e && e.length && (e[1] = b(e[1])), e }(t); if (!r || !r.length) return; var o = l(r, 3); e = o[1], n = S(o[2], a) } !function (t, e, n, r) { f.dispatch(t, e, n, r) || (1 === e.length && (e = e[0]), n[t] instanceof Array ? n[t].push(e) : "object" === u(n[t]) ? n[t] = [n[t], e] : n[t] = e) }(e, n, c, i) }), function (t, e) { "LEVEL" === e && (t.live = void 0 === t.live || t.live), f.dispatch("extraProps", null, t, e) }(c, i), function (t) { t.segments.length || t.levels.length ? t.segments.length ? t.segments = t.segments.filter(function (t) { return t.duration && t.url }) : t.levels.length && (t.levels = t.levels.filter(function (t) { return t.bandwidth && t.url })) : t.error = g }(c), E(c.levels, c), function (t, e) { if (t.levels.length && e.length) { t.levels = t.levels.filter(function (t) { return -1 === e.indexOf(t.streamtype) }); var n = t.levels.length; t.levels.forEach(function (t, e) { t.levelId = n - e }) } }(c, n.concat(["3gphd"])), c } catch (t) { return console.log(t), c.error = g, c } }, t }({});;